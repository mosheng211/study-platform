# ğŸ“š å­¦ä¹ å¹³å° - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

åŸºäºLaravel + Vue.jsçš„å­¦ä¹ èµ„æºç®¡ç†å¹³å°ï¼Œæ”¯æŒå¤šåˆ†ç±»å­¦ä¹ èµ„æºç®¡ç†ã€ç”¨æˆ·å­¦ä¹ è¿›åº¦è·Ÿè¸ªç­‰åŠŸèƒ½ã€‚

## ğŸ”§ ç¯å¢ƒè¦æ±‚

### æœåŠ¡å™¨é…ç½®
- **æ“ä½œç³»ç»Ÿ**: Linux (æ¨èUbuntu 20.04+/CentOS 7+)
- **å†…å­˜**: æœ€ä½2GBï¼Œæ¨è4GB+
- **å­˜å‚¨**: æœ€ä½20GBï¼Œæ¨è50GB+
- **CPU**: 2æ ¸+

### è½¯ä»¶ç¯å¢ƒ
- **PHP**: 8.0+ (æ¨è8.1+)
- **MySQL**: 5.7+ æˆ– 8.0+
- **Node.js**: 16+ (æ¨è18+)
- **npm/yarn**: æœ€æ–°ç‰ˆæœ¬
- **Nginx**: 1.18+
- **Composer**: 2.0+

### PHPæ‰©å±•è¦æ±‚
```bash
# å¿…éœ€æ‰©å±•
php-fpm
php-mysql
php-mbstring
php-xml
php-curl
php-zip
php-bcmath
php-json
php-tokenizer
php-fileinfo
php-gd
```

## ğŸ“¦ éƒ¨ç½²æ­¥éª¤

### 1. æœåŠ¡å™¨å‡†å¤‡

#### 1.1 æ›´æ–°ç³»ç»Ÿ
```bash
# Ubuntu/Debian
sudo apt update && sudo apt upgrade -y

# CentOS/RHEL
sudo yum update -y
```

#### 1.2 å®‰è£…åŸºç¡€è½¯ä»¶
```bash
# Ubuntu/Debian
sudo apt install -y nginx mysql-server php8.1-fpm php8.1-mysql php8.1-mbstring \
php8.1-xml php8.1-curl php8.1-zip php8.1-bcmath php8.1-json php8.1-tokenizer \
php8.1-fileinfo php8.1-gd composer nodejs npm git unzip

# CentOS/RHEL (éœ€è¦å…ˆæ·»åŠ EPELå’ŒRemiä»“åº“)
sudo yum install -y epel-release
sudo yum install -y nginx mysql-server php81-php-fpm php81-php-mysql php81-php-mbstring \
php81-php-xml php81-php-curl php81-php-zip php81-php-bcmath php81-php-json \
php81-php-tokenizer php81-php-fileinfo php81-php-gd composer nodejs npm git unzip
```

### 2. åˆ›å»ºéƒ¨ç½²ç›®å½•

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
sudo mkdir -p /var/www/study-platform
sudo chown -R $USER:$USER /var/www/study-platform

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /var/www/study-platform
```

### 3. ä»£ç éƒ¨ç½²

#### 3.1 ä¸Šä¼ ä»£ç 
```bash
# æ–¹å¼1: Gitå…‹éš† (æ¨è)
git clone <your-repository-url> .

# æ–¹å¼2: ç›´æ¥ä¸Šä¼ å‹ç¼©åŒ…
# å°†é¡¹ç›®æ–‡ä»¶æ‰“åŒ…ä¸Šä¼ å¹¶è§£å‹åˆ° /var/www/study-platform/
```

#### 3.2 è®¾ç½®æ–‡ä»¶æƒé™
```bash
# è®¾ç½®ç›®å½•æƒé™
sudo chown -R www-data:www-data /var/www/study-platform
sudo chmod -R 755 /var/www/study-platform
sudo chmod -R 777 /var/www/study-platform/storage
sudo chmod -R 777 /var/www/study-platform/bootstrap/cache
```

### 4. Laravelåç«¯éƒ¨ç½²

#### 4.1 å®‰è£…Composerä¾èµ–
```bash
cd /var/www/study-platform
composer install --optimize-autoloader --no-dev
```

#### 4.2 é…ç½®ç¯å¢ƒæ–‡ä»¶
```bash
# å¤åˆ¶ç¯å¢ƒé…ç½®æ–‡ä»¶
cp .env.example .env

# ç”Ÿæˆåº”ç”¨å¯†é’¥
php artisan key:generate
```

#### 4.3 ç¼–è¾‘ç¯å¢ƒé…ç½®
```bash
vim .env
```

```env
# åº”ç”¨é…ç½®
APP_NAME="å­¦ä¹ å¹³å°"
APP_ENV=production
APP_KEY=base64:your-generated-key
APP_DEBUG=false
APP_URL=https://yourdomain.com

# æ•°æ®åº“é…ç½®
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=study_platform
DB_USERNAME=study_platform_user
DB_PASSWORD=your-secure-password

# ç¼“å­˜é…ç½® (ç”Ÿäº§ç¯å¢ƒæ¨èRedis)
CACHE_DRIVER=file
SESSION_DRIVER=file
QUEUE_CONNECTION=sync

# é‚®ä»¶é…ç½® (å¦‚éœ€è¦)
MAIL_MAILER=smtp
MAIL_HOST=your-smtp-host
MAIL_PORT=587
MAIL_USERNAME=your-email
MAIL_PASSWORD=your-password
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS=noreply@yourdomain.com
MAIL_FROM_NAME="å­¦ä¹ å¹³å°"
```

### 5. æ•°æ®åº“è®¾ç½®

#### 5.1 åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
```sql
-- ç™»å½•MySQL
mysql -u root -p

-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE study_platform CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- åˆ›å»ºä¸“ç”¨ç”¨æˆ·
CREATE USER 'study_platform_user'@'localhost' IDENTIFIED BY 'your-secure-password';
GRANT ALL PRIVILEGES ON study_platform.* TO 'study_platform_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

#### 5.2 æ‰§è¡Œæ•°æ®åº“è¿ç§»
```bash
cd /var/www/study-platform

# è¿è¡Œè¿ç§»
php artisan migrate --force

# å¡«å……åŸºç¡€æ•°æ® (å¦‚æœ‰)
php artisan db:seed --force
```

#### 5.3 å¯¼å…¥ç°æœ‰æ•°æ®
```bash
# å¦‚æœæœ‰ç°æœ‰æ•°æ®éœ€è¦å¯¼å…¥
# 1. ä»å¼€å‘ç¯å¢ƒå¯¼å‡ºæ•°æ®
mysqldump -u root -p61263269 study_platform > study_platform_backup.sql

# 2. ä¸Šä¼ åˆ°ç”Ÿäº§æœåŠ¡å™¨å¹¶å¯¼å…¥
mysql -u study_platform_user -p study_platform < study_platform_backup.sql

# 3. æˆ–è€…ä½¿ç”¨å¯¼å…¥è„šæœ¬
php artisan import:resources
```

### 6. Vue.jså‰ç«¯éƒ¨ç½²

#### 6.1 å®‰è£…Node.jsä¾èµ–
```bash
cd /var/www/study-platform/frontend

# å®‰è£…ä¾èµ–
npm install

# é…ç½®ç”Ÿäº§ç¯å¢ƒAPIåœ°å€
echo "VITE_API_URL=https://yourdomain.com/api" > .env.production
```

#### 6.2 æ„å»ºç”Ÿäº§ç‰ˆæœ¬
```bash
# æ„å»ºå‰ç«¯
npm run build

# å¤åˆ¶æ„å»ºæ–‡ä»¶åˆ°publicç›®å½•
cp -r dist/* ../public/
```

### 7. Nginxé…ç½®

#### 7.1 åˆ›å»ºç«™ç‚¹é…ç½®
```bash
sudo vim /etc/nginx/sites-available/study-platform
```

```nginx
server {
    listen 80;
    server_name yourdomain.com www.yourdomain.com;
    
    # é‡å®šå‘åˆ°HTTPS (æ¨è)
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name yourdomain.com www.yourdomain.com;
    
    root /var/www/study-platform/public;
    index index.php index.html;
    
    # SSLè¯ä¹¦é…ç½®
    ssl_certificate /path/to/your/certificate.crt;
    ssl_certificate_key /path/to/your/private.key;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    
    # å®‰å…¨å¤´
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
    add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'" always;
    
    # Gzipå‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
    
    # ä¸»è¦è·¯ç”±é…ç½®
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }
    
    # APIè·¯ç”±
    location /api {
        try_files $uri $uri/ /index.php?$query_string;
    }
    
    # PHPå¤„ç†
    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;
        fastcgi_hide_header X-Powered-By;
    }
    
    # é™æ€æ–‡ä»¶ç¼“å­˜
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|woff|woff2|ttf|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # ç¦æ­¢è®¿é—®æ•æ„Ÿæ–‡ä»¶
    location ~ /\. {
        deny all;
    }
    
    location ~ /\.(env|git) {
        deny all;
    }
}
```

#### 7.2 å¯ç”¨ç«™ç‚¹
```bash
# åˆ›å»ºè½¯é“¾æ¥
sudo ln -s /etc/nginx/sites-available/study-platform /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯Nginx
sudo systemctl restart nginx
sudo systemctl enable nginx
```

### 8. PHP-FPMé…ç½®ä¼˜åŒ–

```bash
sudo vim /etc/php/8.1/fpm/pool.d/www.conf
```

```ini
; æ€§èƒ½ä¼˜åŒ–é…ç½®
pm = dynamic
pm.max_children = 50
pm.start_servers = 5
pm.min_spare_servers = 5
pm.max_spare_servers = 35
pm.process_idle_timeout = 10s
pm.max_requests = 500

; å†…å­˜é™åˆ¶
php_admin_value[memory_limit] = 256M
php_admin_value[upload_max_filesize] = 50M
php_admin_value[post_max_size] = 50M
```

### 9. ç³»ç»ŸæœåŠ¡é…ç½®

#### 9.1 å¯åŠ¨æ‰€æœ‰æœåŠ¡
```bash
# å¯åŠ¨MySQL
sudo systemctl start mysql
sudo systemctl enable mysql

# å¯åŠ¨PHP-FPM
sudo systemctl start php8.1-fpm
sudo systemctl enable php8.1-fpm

# å¯åŠ¨Nginx
sudo systemctl start nginx
sudo systemctl enable nginx
```

#### 9.2 é…ç½®Laravelå®šæ—¶ä»»åŠ¡ (å¦‚éœ€è¦)
```bash
# ç¼–è¾‘crontab
sudo crontab -e

# æ·»åŠ ä»¥ä¸‹è¡Œ
* * * * * cd /var/www/study-platform && php artisan schedule:run >> /dev/null 2>&1
```

### 10. ä¼˜åŒ–é…ç½®

#### 10.1 Laravelä¼˜åŒ–
```bash
cd /var/www/study-platform

# ç¼“å­˜é…ç½®
php artisan config:cache

# ç¼“å­˜è·¯ç”±
php artisan route:cache

# ç¼“å­˜è§†å›¾
php artisan view:cache

# ä¼˜åŒ–è‡ªåŠ¨åŠ è½½å™¨
composer dump-autoload --optimize
```

#### 10.2 æ•°æ®åº“ä¼˜åŒ–
```sql
-- MySQLé…ç½®ä¼˜åŒ– (æ ¹æ®æœåŠ¡å™¨é…ç½®è°ƒæ•´)
-- ç¼–è¾‘ /etc/mysql/mysql.conf.d/mysqld.cnf

[mysqld]
innodb_buffer_pool_size = 1G
innodb_log_file_size = 256M
max_connections = 100
query_cache_size = 64M
tmp_table_size = 64M
max_heap_table_size = 64M
```

## ğŸ” éªŒè¯éƒ¨ç½²

### 11.1 æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status nginx
sudo systemctl status php8.1-fpm
sudo systemctl status mysql

# æ£€æŸ¥ç«¯å£ç›‘å¬
sudo netstat -tlnp | grep :80
sudo netstat -tlnp | grep :443
sudo netstat -tlnp | grep :3306
```

### 11.2 åŠŸèƒ½éªŒè¯
1. **è®¿é—®ä¸»é¡µ**: https://yourdomain.com
2. **APIæµ‹è¯•**: https://yourdomain.com/api/resources
3. **ç®¡ç†åå°**: https://yourdomain.com/admin
4. **æ•°æ®åº“è¿æ¥**: ç¡®è®¤æ•°æ®æ­£ç¡®æ˜¾ç¤º

## ğŸ” å®‰å…¨é…ç½®

### 12.1 é˜²ç«å¢™è®¾ç½®
```bash
# Ubuntu UFW
sudo ufw allow ssh
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable

# CentOS Firewalld
sudo firewall-cmd --permanent --add-service=ssh
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
```

### 12.2 SSLè¯ä¹¦é…ç½®
```bash
# ä½¿ç”¨Let's Encrypt (æ¨è)
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com

# è®¾ç½®è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ : 0 12 * * * /usr/bin/certbot renew --quiet
```

### 12.3 æ•°æ®åº“å®‰å…¨
```bash
# è¿è¡ŒMySQLå®‰å…¨è„šæœ¬
sudo mysql_secure_installation
```

## ğŸ“ˆ ç›‘æ§ä¸ç»´æŠ¤

### 13.1 æ—¥å¿—é…ç½®
```bash
# åˆ›å»ºæ—¥å¿—ç›®å½•
sudo mkdir -p /var/log/study-platform

# é…ç½®æ—¥å¿—è½®è½¬
sudo vim /etc/logrotate.d/study-platform
```

### 13.2 å¤‡ä»½è„šæœ¬
```bash
#!/bin/bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
sudo vim /usr/local/bin/backup-study-platform.sh

DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/var/backups/study-platform"
mkdir -p $BACKUP_DIR

# å¤‡ä»½æ•°æ®åº“
mysqldump -u study_platform_user -p study_platform > $BACKUP_DIR/db_$DATE.sql

# å¤‡ä»½æ–‡ä»¶
tar -czf $BACKUP_DIR/files_$DATE.tar.gz -C /var/www study-platform

# åˆ é™¤7å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "*.sql" -mtime +7 -delete
find $BACKUP_DIR -name "*.tar.gz" -mtime +7 -delete
```

## â— å¸¸è§é—®é¢˜æ’æŸ¥

### 14.1 æƒé™é—®é¢˜
```bash
# é‡æ–°è®¾ç½®æƒé™
sudo chown -R www-data:www-data /var/www/study-platform
sudo chmod -R 755 /var/www/study-platform
sudo chmod -R 777 /var/www/study-platform/storage
sudo chmod -R 777 /var/www/study-platform/bootstrap/cache
```

### 14.2 ç¼“å­˜æ¸…ç†
```bash
# æ¸…é™¤Laravelç¼“å­˜
php artisan cache:clear
php artisan config:clear
php artisan route:clear
php artisan view:clear

# é‡æ–°ç¼“å­˜
php artisan config:cache
php artisan route:cache
php artisan view:cache
```

### 14.3 æ•°æ®åº“è¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥æ•°æ®åº“è¿æ¥
php artisan tinker
>>> DB::connection()->getPdo();
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°éƒ¨ç½²é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. **æ—¥å¿—æ–‡ä»¶**: `/var/www/study-platform/storage/logs/laravel.log`
2. **Nginxæ—¥å¿—**: `/var/log/nginx/error.log`
3. **PHP-FPMæ—¥å¿—**: `/var/log/php8.1-fpm.log`
4. **MySQLæ—¥å¿—**: `/var/log/mysql/error.log`

---

**ğŸ‰ éƒ¨ç½²å®Œæˆåï¼Œæ‚¨çš„å­¦ä¹ å¹³å°å°±å¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ­£å¸¸è¿è¡Œäº†ï¼** 